import React from "react";
import axios from "axios";
const withFetchData = Component => {
  class MyComponent extends React.Component {
    static url = "http://127.0.0.1:8848/api/todos/";
    constructor() {
      super();
      this.state = {
        list: [],
        query: ""
      };
    }

    fetchData = async (query = "") => {
      try {
        const token = localStorage.getItem("accessToken");
        let res = await axios({
          method: "get",
          url: "http://127.0.0.1:8848/api/todos",
          config: {
            headers: {
              "Content-Type": "application/json",
              "oauth"
: token
            }
          }
        });
        // this.setState({ list: res.json().data });
        console.log(res);
      } catch (err) {
        console.log(err);
      }
    };

    componentDidMount() {
      console.log("compound did mount");
      this.fetchData();
    }

    componentWillReceiveProps(nextProps) {
      if (this.props.query != nextProps.query) {
        this.fetchData("?title=" + nextProps.query);
      }
    }

    render() {
      return (
        <Component lists={this.state.list} setQuery={this.props.setQuery} />
      );
    }
  }

  return MyComponent;
};

export default withFetchData;
